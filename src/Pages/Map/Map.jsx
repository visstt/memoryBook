import React, { useEffect, useRef, useState } from "react";
import L from "leaflet";
import "leaflet/dist/leaflet.css";
import proj4 from "proj4";
import { IconButton } from "@mui/material";
import CloseIcon from "@mui/icons-material/Close";

export default function Map() {
  const mapContainer = useRef(null);
  const [data, setData] = useState([]);
  const [selectedFeature, setSelectedFeature] = useState(null);
  const [isSidebarOpen, setIsSidebarOpen] = useState(false);
  const mapRef = useRef(null);

  // Определяем проекции для преобразования координат
  proj4.defs(
    "EPSG:3857",
    "+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs"
  );
  proj4.defs("EPSG:4326", "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs");

  useEffect(() => {
    if (!mapRef.current) {
      const map = L.map(mapContainer.current).setView([52.5, 56.0], 10);
      mapRef.current = map;

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      }).addTo(map);

      // Добавляем границы Тюльганского района
      const tulganDistrictBoundary = {
        type: "FeatureCollection",
        features: [
          {
            type: "Feature",
            properties: {},
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [56.2013518, 52.1402014],
                  [56.2027409, 52.1474431],
                  [56.2007934, 52.1628908],
                  [56.200487, 52.1653208],
                  [56.2190649, 52.1907799],
                  [56.2379483, 52.2186666],
                  [56.2500222, 52.2104614],
                  [56.260863, 52.2033386],
                  [56.2808912, 52.2240858],
                  [56.2792132, 52.2252324],
                  [56.281521, 52.2263503],
                  [56.2739057, 52.2312414],
                  [56.2860081, 52.2387741],
                  [56.2931861, 52.2396857],
                  [56.3241085, 52.2475208],
                  [56.314058, 52.2560764],
                  [56.3174207, 52.2569842],
                  [56.3592062, 52.280525],
                  [56.3713903, 52.2825226],
                  [56.4027708, 52.2830803],
                  [56.4087782, 52.2870523],
                  [56.4149054, 52.2876736],
                  [56.4206554, 52.2935201],
                  [56.4229451, 52.2926223],
                  [56.4256066, 52.293544],
                  [56.4259806, 52.2925841],
                  [56.4268549, 52.2925592],
                  [56.427291, 52.2925767],
                  [56.4550195, 52.298115],
                  [56.4540066, 52.3178205],
                  [56.4340809, 52.3311105],
                  [56.4409744, 52.3370514],
                  [56.4444942, 52.3431973],
                  [56.4402866, 52.3445245],
                  [56.4443963, 52.3513245],
                  [56.4423494, 52.3536833],
                  [56.4442277, 52.3600545],
                  [56.4430923, 52.3618989],
                  [56.4421259, 52.3638868],
                  [56.4427354, 52.3733004],
                  [56.4420674, 52.3745831],
                  [56.4406674, 52.3750741],
                  [56.4327441, 52.3751944],
                  [56.4330794, 52.3815271],
                  [56.4366559, 52.3933648],
                  [56.4407196, 52.4062663],
                  [56.4561392, 52.4094857],
                  [56.4545496, 52.414686],
                  [56.4598377, 52.4151585],
                  [56.4586544, 52.4207956],
                  [56.4585636, 52.4232971],
                  [56.4589333, 52.4252578],
                  [56.4596844, 52.4269457],
                  [56.4619853, 52.430641],
                  [56.463654, 52.4302428],
                  [56.4660573, 52.4298111],
                  [56.4680743, 52.4294578],
                  [56.4696622, 52.4303082],
                  [56.4717436, 52.4296148],
                  [56.4775586, 52.4276915],
                  [56.4785671, 52.4278877],
                  [56.4802623, 52.4281625],
                  [56.4816141, 52.4285812],
                  [56.482923, 52.429026],
                  [56.4844465, 52.4293008],
                  [56.4860773, 52.42917],
                  [56.4866352, 52.42917],
                  [56.4874291, 52.4296671],
                  [56.4883089, 52.4308446],
                  [56.4894676, 52.431852],
                  [56.4916134, 52.4321529],
                  [56.4932656, 52.432323],
                  [56.4944672, 52.4325454],
                  [56.4955401, 52.4330425],
                  [56.4958191, 52.433749],
                  [56.4964843, 52.435188],
                  [56.4965701, 52.4360645],
                  [56.4959049, 52.4378174],
                  [56.4945531, 52.4385238],
                  [56.4926004, 52.4389554],
                  [56.4910769, 52.4396356],
                  [56.4910126, 52.4404597],
                  [56.4913344, 52.4414799],
                  [56.492815, 52.4421863],
                  [56.4933514, 52.4423171],
                  [56.493566, 52.443782],
                  [56.4941883, 52.4449329],
                  [56.4954114, 52.44577],
                  [56.4960658, 52.4466593],
                  [56.4961201, 52.4469744],
                  [56.495111, 52.4471367],
                  [56.4939801, 52.4474009],
                  [56.4909603, 52.4493123],
                  [56.4833374, 52.4539373],
                  [56.4767137, 52.4578683],
                  [56.4709735, 52.4610316],
                  [56.466186, 52.4641286],
                  [56.462318, 52.466469],
                  [56.4608044, 52.4670731],
                  [56.4553365, 52.468678],
                  [56.4502215, 52.4699066],
                  [56.4441551, 52.4711664],
                  [56.4438057, 52.4699851],
                  [56.4445567, 52.4653575],
                  [56.4445996, 52.4588337],
                  [56.4439396, 52.4537076],
                  [56.4434904, 52.4489218],
                  [56.4434262, 52.4453054],
                  [56.4407801, 52.4448544],
                  [56.4358663, 52.4452599],
                  [56.4342141, 52.4455345],
                  [56.4305702, 52.4450737],
                  [56.4313817, 52.4419247],
                  [56.4323902, 52.4394002],
                  [56.4327764, 52.43889],
                  [56.4331198, 52.4368886],
                  [56.4344287, 52.4364439],
                  [56.4351368, 52.435659],
                  [56.434536, 52.4335266],
                  [56.4340639, 52.4330949],
                  [56.4326498, 52.4284067],
                  [56.4234164, 52.4234082],
                  [56.4189577, 52.4226538],
                  [56.4157176, 52.4224052],
                  [56.4119625, 52.4221958],
                  [56.409924, 52.4224575],
                  [56.4075384, 52.4229214],
                  [56.404624, 52.4229286],
                  [56.401813, 52.4224968],
                  [56.3996243, 52.4218556],
                  [56.3979278, 52.4218591],
                  [56.3948233, 52.4219815],
                  [56.3826542, 52.4198619],
                  [56.3510953, 52.4969409],
                  [56.3695037, 52.5032271],
                  [56.3815435, 52.509094],
                  [56.3748489, 52.5164332],
                  [56.3743901, 52.5174352],
                  [56.373918, 52.5208431],
                  [56.3729095, 52.5255954],
                  [56.3735877, 52.5299606],
                  [56.3852288, 52.5320397],
                  [56.4132798, 52.5380225],
                  [56.4224471, 52.5413633],
                  [56.4293178, 52.5437454],
                  [56.419485, 52.5489349],
                  [56.4165898, 52.5542969],
                  [56.4059962, 52.5597265],
                  [56.4208423, 52.5689746],
                  [56.4348138, 52.5767712],
                  [56.4317678, 52.5792183],
                  [56.4320469, 52.5793751],
                  [56.4321112, 52.5797532],
                  [56.4324975, 52.5798575],
                  [56.4327979, 52.5795837],
                  [56.4333558, 52.5795968],
                  [56.4337849, 52.5797532],
                  [56.4339995, 52.5802096],
                  [56.434493, 52.580001],
                  [56.4348364, 52.5797272],
                  [56.4353514, 52.5796098],
                  [56.4356518, 52.5799227],
                  [56.4357805, 52.5805877],
                  [56.4366388, 52.5808094],
                  [56.4374037, 52.5806525],
                  [56.4388919, 52.5804052],
                  [56.4402652, 52.5806399],
                  [56.4418024, 52.5813306],
                  [56.444664, 52.5821262],
                  [56.4451609, 52.5828772],
                  [56.445179, 52.5838081],
                  [56.4448751, 52.5843287],
                  [56.443634, 52.5851901],
                  [56.4432068, 52.5860559],
                  [56.4432019, 52.5879734],
                  [56.4442348, 52.588345],
                  [56.4450073, 52.5883059],
                  [56.4458012, 52.5884102],
                  [56.4458012, 52.5886709],
                  [56.445415, 52.5889838],
                  [56.4459944, 52.5896226],
                  [56.4466274, 52.5897203],
                  [56.4466059, 52.5901635],
                  [56.4464128, 52.5907762],
                  [56.446799, 52.5910826],
                  [56.4468419, 52.5915062],
                  [56.4467347, 52.591806],
                  [56.4470994, 52.5921189],
                  [56.4469814, 52.5924252],
                  [56.4464986, 52.5925686],
                  [56.4459836, 52.5926924],
                  [56.4458227, 52.5929531],
                  [56.44593, 52.5932529],
                  [56.444941, 52.593953],
                  [56.4447391, 52.5944782],
                  [56.4436126, 52.5950126],
                  [56.4430976, 52.5952472],
                  [56.4426362, 52.5952537],
                  [56.4420783, 52.5950973],
                  [56.4415204, 52.594804],
                  [56.4413917, 52.5944521],
                  [56.4411771, 52.5941654],
                  [56.4403725, 52.5940806],
                  [56.4397824, 52.5943674],
                  [56.4397931, 52.5947519],
                  [56.4401257, 52.5949539],
                  [56.441102, 52.5950713],
                  [56.4416063, 52.5951364],
                  [56.4421105, 52.595371],
                  [56.4424324, 52.5958924],
                  [56.4422929, 52.5965637],
                  [56.4418745, 52.5970198],
                  [56.4411342, 52.5973001],
                  [56.4399862, 52.5974369],
                  [56.4388168, 52.5974304],
                  [56.4380658, 52.5973587],
                  [56.4374542, 52.5974109],
                  [56.4369607, 52.5975998],
                  [56.4365208, 52.5975347],
                  [56.4359844, 52.5970459],
                  [56.4355659, 52.5970459],
                  [56.4352119, 52.5973848],
                  [56.434772, 52.5978801],
                  [56.4344072, 52.5981277],
                  [56.4340317, 52.5982385],
                  [56.4334309, 52.5981016],
                  [56.4333451, 52.5978214],
                  [56.4335275, 52.5975282],
                  [56.4334845, 52.5972805],
                  [56.4331734, 52.5971697],
                  [56.4328408, 52.5973066],
                  [56.432755, 52.5975542],
                  [56.4328623, 52.5978019],
                  [56.433388, 52.5984926],
                  [56.4333987, 52.5988901],
                  [56.4330232, 52.5990531],
                  [56.4328301, 52.5995157],
                  [56.4325082, 52.5997959],
                  [56.4319503, 52.5998807],
                  [56.4312744, 52.5998285],
                  [56.4305556, 52.5996526],
                  [56.429429, 52.5993593],
                  [56.4288497, 52.5993268],
                  [56.4285171, 52.5994115],
                  [56.4283347, 52.5996721],
                  [56.428163, 52.5999328],
                  [56.4278519, 52.600011],
                  [56.4275622, 52.5999849],
                  [56.4272296, 52.5998611],
                  [56.4271545, 52.5995157],
                  [56.4269721, 52.5993984],
                  [56.426617, 52.5994413],
                  [56.426028, 52.5996721],
                  [56.4260924, 52.6000631],
                  [56.4257598, 52.6005909],
                  [56.4252663, 52.6007864],
                  [56.4244616, 52.6006822],
                  [56.4241934, 52.6005127],
                  [56.4236355, 52.6005453],
                  [56.4233673, 52.600793],
                  [56.4234531, 52.6011057],
                  [56.4233887, 52.601399],
                  [56.422981, 52.601614],
                  [56.4226913, 52.6016335],
                  [56.4220369, 52.6014381],
                  [56.421554, 52.6015507],
                  [56.4213073, 52.6018551],
                  [56.4214253, 52.6022396],
                  [56.4216828, 52.6023373],
                  [56.4220691, 52.6022396],
                  [56.4226055, 52.6023438],
                  [56.4231634, 52.6026827],
                  [56.4239573, 52.603217],
                  [56.4245581, 52.6033864],
                  [56.4251375, 52.6036209],
                  [56.4252448, 52.6039728],
                  [56.4245184, 52.6042958],
                  [56.4234853, 52.6046635],
                  [56.4226913, 52.6045071],
                  [56.4218116, 52.6039076],
                  [56.4209962, 52.6036731],
                  [56.4200306, 52.6037122],
                  [56.4187217, 52.6030606],
                  [56.4176763, 52.6031657],
                  [56.4168827, 52.6036036],
                  [56.4138508, 52.6029954],
                  [56.4093094, 52.6024896],
                  [56.3710536, 52.5977539],
                  [56.3639046, 52.595365],
                  [56.3325578, 52.5853143],
                  [56.3298143, 52.5837728],
                  [56.3107681, 52.5730116],
                  [56.289525, 52.5614559],
                  [56.2839262, 52.5564784],
                  [56.262206, 52.5458692],
                  [56.2312504, 52.5646216],
                  [56.2193883, 52.5726546],
                  [56.2159681, 52.5768455],
                  [56.2136507, 52.5805747],
                  [56.2097406, 52.5858144],
                  [56.1907428, 52.5995417],
                  [56.1899094, 52.5933795],
                  [56.1848432, 52.5912509],
                  [56.1823869, 52.5917734],
                  [56.1815285, 52.5913302],
                  [56.1630952, 52.5902153],
                  [56.1622331, 52.591595],
                  [56.1590014, 52.5912305],
                  [56.156632, 52.5922077],
                  [56.1570883, 52.5927902],
                  [56.1612711, 52.5946524],
                  [56.1657948, 52.6008447],
                  [56.1574989, 52.6099828],
                  [56.156466, 52.6115696],
                  [56.1547708, 52.6150614],
                  [56.153419, 52.6189827],
                  [56.1510602, 52.6243131],
                  [56.1484437, 52.6317004],
                  [56.1380601, 52.6319579],
                  [56.1254349, 52.6335718],
                  [56.1239732, 52.6310627],
                  [56.1101907, 52.6193405],
                  [56.081817, 52.6207029],
                  [56.0739659, 52.6213038],
                  [56.0949451, 52.6348584],
                  [56.0958949, 52.6348572],
                  [56.0979634, 52.6363954],
                  [56.1162915, 52.6396422],
                  [56.1212518, 52.6386385],
                  [56.1268807, 52.6456695],
                  [56.1148965, 52.6504804],
                  [56.1107592, 52.6492315],
                  [56.0871837, 52.6465253],
                  [56.0704599, 52.6448647],
                  [56.0548929, 52.6471829],
                  [56.0499439, 52.6471433],
                  [56.0360318, 52.6470308],
                  [56.053191, 52.6336462],
                  [56.0628627, 52.6337678],
                  [56.0686263, 52.6300534],
                  [56.0624041, 52.6288127],
                  [56.0678334, 52.6238632],
                  [56.0643922, 52.6212834],
                  [56.0649136, 52.6201862],
                  [56.064696, 52.6181229],
                  [56.062833, 52.6172491],
                  [56.0591728, 52.6123973],
                  [56.0531383, 52.5909467],
                  [56.0270519, 52.5760986],
                  [56.0371594, 52.5711465],
                  [56.0366093, 52.5702407],
                  [56.0064148, 52.5489071],
                  [55.9994713, 52.5534384],
                  [55.9880596, 52.561178],
                  [55.9864773, 52.5607385],
                  [55.9845163, 52.5610256],
                  [55.9827569, 52.5608404],
                  [55.9817513, 52.561635],
                  [55.9802405, 52.561934],
                  [55.9779638, 52.5607792],
                  [55.9776957, 52.5600661],
                  [55.9756174, 52.5597694],
                  [55.9763214, 52.5584767],
                  [55.9737049, 52.5588982],
                  [55.97064, 52.557342],
                  [55.9662665, 52.5577878],
                  [55.9681385, 52.5468982],
                  [55.9609699, 52.5441556],
                  [55.9635881, 52.5416149],
                  [55.9521071, 52.5275595],
                  [55.9440624, 52.5152938],
                  [55.9407777, 52.5125647],
                  [55.9370239, 52.5101187],
                  [55.9203326, 52.5096664],
                  [55.9178345, 52.5134383],
                  [55.9284532, 52.52126],
                  [55.9218059, 52.5306729],
                  [55.9119977, 52.5359358],
                  [55.9221101, 52.5528415],
                  [55.9081333, 52.5599448],
                  [55.8852579, 52.5444422],
                  [55.8675919, 52.5457814],
                  [55.8664083, 52.5348616],
                  [55.8722313, 52.5345005],
                  [55.871737, 52.531362],
                  [55.8710024, 52.5283126],
                  [55.8632474, 52.4960933],
                  [55.8660712, 52.4883174],
                  [55.8582992, 52.4868253],
                  [55.8555478, 52.4824979],
                  [55.8518356, 52.4816214],
                  [55.8501216, 52.4795645],
                  [55.851493, 52.4745937],
                  [55.8485791, 52.4740795],
                  [55.8482364, 52.4703085],
                  [55.8713781, 52.4146875],
                  [55.8787487, 52.4128021],
                  [55.8866492, 52.4085583],
                  [55.8820598, 52.3961547],
                  [55.8630115, 52.3903147],
                  [55.857774, 52.3895304],
                  [55.8426587, 52.3787231],
                  [55.8424525, 52.3785756],
                  [55.8330957, 52.3718842],
                  [55.8239194, 52.3653209],
                  [55.8234173, 52.3649617],
                  [55.7981977, 52.3769247],
                  [55.7929006, 52.3708648],
                  [55.784648, 52.361422],
                  [55.7704823, 52.3471874],
                  [55.774656, 52.3419233],
                  [55.7776697, 52.3401957],
                  [55.7823637, 52.3375978],
                  [55.7945804, 52.3342328],
                  [55.824153, 52.3266591],
                  [55.8423725, 52.3377569],
                  [55.8455741, 52.3414632],
                  [55.8498711, 52.3443972],
                  [55.85282, 52.3454267],
                  [55.8612454, 52.3514998],
                  [55.8931776, 52.3556681],
                  [55.885342, 52.3413088],
                  [55.8698393, 52.3314759],
                  [55.8877011, 52.3238552],
                  [55.8744619, 52.3162188],
                  [55.863773, 52.3102582],
                  [55.8453214, 52.3127822],
                  [55.8347896, 52.3050552],
                  [55.794095, 52.3175722],
                  [55.7678313, 52.2970109],
                  [55.7488506, 52.2864534],
                  [55.7583713, 52.2808353],
                  [55.7318313, 52.2729996],
                  [55.7294722, 52.2732574],
                  [55.7256808, 52.2726903],
                  [55.7224791, 52.2673282],
                  [55.7250068, 52.244171],
                  [55.6360346, 52.2397858],
                  [55.6238178, 52.2394762],
                  [55.6080623, 52.2373092],
                  [55.6077253, 52.2349873],
                  [55.612949, 52.2285886],
                  [55.612949, 52.2262146],
                  [55.6165719, 52.2216728],
                  [55.6247446, 52.2190919],
                  [55.6261769, 52.2116584],
                  [55.6286203, 52.2100063],
                  [55.6314006, 52.2021065],
                  [55.6346865, 52.1983884],
                  [55.6334227, 52.1962194],
                  [55.6370456, 52.1916229],
                  [55.6561017, 52.1843893],
                  [55.6571943, 52.1815199],
                  [55.6574422, 52.178807],
                  [55.6620403, 52.176919],
                  [55.6646522, 52.1743357],
                  [55.6651577, 52.1724238],
                  [55.6637989, 52.1696846],
                  [55.6638831, 52.1655657],
                  [55.6680844, 52.155968],
                  [55.6712988, 52.1512341],
                  [55.6981935, 52.1600445],
                  [55.7237318, 52.161122],
                  [55.724254, 52.1570159],
                  [55.7333695, 52.1567953],
                  [55.7434914, 52.1566792],
                  [55.7558684, 52.158472],
                  [55.7562956, 52.1595786],
                  [55.7576247, 52.1605104],
                  [55.7613748, 52.1600445],
                  [55.7661217, 52.1600445],
                  [55.771575, 52.160901],
                  [55.7739424, 52.161753],
                  [55.775424, 52.1627763],
                  [55.7779609, 52.1657979],
                  [55.7812567, 52.166892],
                  [55.7817201, 52.1657809],
                  [55.7802457, 52.1644631],
                  [55.7815938, 52.1629644],
                  [55.7798665, 52.1624217],
                  [55.7796559, 52.1606644],
                  [55.7807512, 52.1597858],
                  [55.7801193, 52.1587519],
                  [55.7817201, 52.1576665],
                  [55.7827733, 52.1567619],
                  [55.7821414, 52.1547202],
                  [55.783321, 52.1547719],
                  [55.783995, 52.1541774],
                  [55.7859328, 52.1548235],
                  [55.8471117, 52.1578958],
                  [55.8492571, 52.1392913],
                  [55.8516024, 52.1390407],
                  [55.8563944, 52.1393587],
                  [55.8579751, 52.1358492],
                  [55.8611292, 52.1307973],
                  [55.8716978, 52.1314401],
                  [55.8810572, 52.127871],
                  [55.8776507, 52.1403772],
                  [55.8789987, 52.1414114],
                  [55.9135007, 52.1535352],
                  [55.9266865, 52.1406875],
                  [56.0209553, 52.1636789],
                  [56.0267636, 52.1599074],
                  [56.0257773, 52.1589831],
                  [56.0604214, 52.1549893],
                  [56.0598806, 52.1520326],
                  [56.0604291, 52.1475008],
                  [56.07488, 52.1365746],
                  [56.0779305, 52.1357694],
                  [56.0951403, 52.1343571],
                  [56.0947278, 52.1320697],
                  [56.1095548, 52.1302982],
                  [56.1239777, 52.1288053],
                  [56.1256504, 52.135198],
                  [56.1293765, 52.1446191],
                  [56.1789818, 52.1416737],
                  [56.1847111, 52.1393468],
                  [56.1973247, 52.1390277],
                  [56.2013518, 52.1402014],
                ],
              ],
            },
          },
        ],
      };

      L.geoJSON(tulganDistrictBoundary, {
        style: {
          color: "red", // Цвет линии
          weight: 2, // Толщина линии
          opacity: 1,
          fillOpacity: 0, // Прозрачность заливки
          dashArray: "5, 5", // Пунктирная линия
          fillColor: "#00bfff", // Цвет заливки (фон) полигона
          fillOpacity: 0.3, // Прозрачность заливки
        },
      }).addTo(map);
    }

    const fetchData = async () => {
      try {
        const response = await fetch(
          "https://geois2.orb.ru/api/resource/8860/feature/",
          {
            headers: {
              Accept: "*/*",
              Authorization: "Basic " + btoa("hackathon_36:hackathon_36_25"),
            },
          }
        );
        const result = await response.json();
        console.log("Данные загружены:", result);
        setData(result);
      } catch (error) {
        console.error("Ошибка загрузки данных:", error);
      }
    };

    fetchData();

    return () => {
      if (mapRef.current) {
        mapRef.current.remove();
        mapRef.current = null;
      }
    };
  }, []);

  useEffect(() => {
    if (data.length > 0 && mapRef.current) {
      const map = mapRef.current;

      map.eachLayer((layer) => {
        if (layer instanceof L.Marker) {
          map.removeLayer(layer);
        }
      });

      data.forEach((feature) => {
        const wkt = feature.geom;
        const regex = /POINT\(([^ ]+) ([^ ]+)\)/;
        const match = wkt.match(regex);
        if (match) {
          const x = parseFloat(match[1]);
          const y = parseFloat(match[2]);
          const [lng, lat] = proj4("EPSG:3857", "EPSG:4326", [x, y]);

          console.log("Добавление маркера:", { lat, lng });

          const marker = L.marker([lat, lng]).addTo(map);

          marker.on("click", () => {
            setSelectedFeature(feature);
            setIsSidebarOpen(true);
          });
        } else {
          console.error("Не удалось распарсить координаты:", wkt);
        }
      });
    }
  }, [data]);

  const closeSidebar = () => {
    setIsSidebarOpen(false);
    setSelectedFeature(null);
  };

  return (
    <div style={{ display: "flex", width: "100%", height: "100vh" }}>
      <div
        style={{
          width: isSidebarOpen ? "300px" : "0",
          height: "100vh",
          overflowY: "auto",
          padding: isSidebarOpen ? "10px" : "0",
          backgroundColor: "#f0f0f0",
          borderRight: "1px solid #ccc",
          transition: "width 0.3s, padding 0.3s",
          position: "relative",
        }}
      >
        {isSidebarOpen && (
          <>
            <IconButton
              onClick={closeSidebar}
              style={{
                position: "absolute",
                top: "10px",
                right: "10px",
                display: { xs: "block", sm: "none" },
              }}
            >
              <CloseIcon />
            </IconButton>

            {selectedFeature ? (
              <table
                style={{
                  width: "100%",
                  borderCollapse: "collapse",
                  marginTop: "20px",
                }}
              >
                <tbody>
                  <tr>
                    <td
                      style={{ padding: "8px", borderBottom: "1px solid #ddd" }}
                    >
                      <b>ФИО:</b>
                    </td>
                    <td
                      style={{ padding: "8px", borderBottom: "1px solid #ddd" }}
                    >
                      {selectedFeature.fields.fio}
                    </td>
                  </tr>
                  <tr>
                    <td
                      style={{ padding: "8px", borderBottom: "1px solid #ddd" }}
                    >
                      <b>Район:</b>
                    </td>
                    <td
                      style={{ padding: "8px", borderBottom: "1px solid #ddd" }}
                    >
                      {selectedFeature.fields.n_raion}
                    </td>
                  </tr>
                  <tr>
                    <td
                      style={{ padding: "8px", borderBottom: "1px solid #ddd" }}
                    >
                      <b>Годы:</b>
                    </td>
                    <td
                      style={{ padding: "8px", borderBottom: "1px solid #ddd" }}
                    >
                      {selectedFeature.fields.years}
                    </td>
                  </tr>
                  <tr>
                    <td
                      style={{ padding: "8px", borderBottom: "1px solid #ddd" }}
                    >
                      <b>Информация:</b>
                    </td>
                    <td
                      style={{ padding: "8px", borderBottom: "1px solid #ddd" }}
                    >
                      {selectedFeature.fields.info}
                    </td>
                  </tr>
                  <tr>
                    <td
                      style={{ padding: "8px", borderBottom: "1px solid #ddd" }}
                    >
                      <b>Контракт:</b>
                    </td>
                    <td
                      style={{ padding: "8px", borderBottom: "1px solid #ddd" }}
                    >
                      {selectedFeature.fields.kontrakt}
                    </td>
                  </tr>
                  <tr>
                    <td
                      style={{ padding: "8px", borderBottom: "1px solid #ddd" }}
                    >
                      <b>Награды:</b>
                    </td>
                    <td
                      style={{ padding: "8px", borderBottom: "1px solid #ddd" }}
                    >
                      {selectedFeature.fields.nagrads}
                    </td>
                  </tr>
                </tbody>
              </table>
            ) : (
              <p>Выберите маркер на карте, чтобы увидеть информацию.</p>
            )}
          </>
        )}
      </div>

      <div
        ref={mapContainer}
        style={{
          flex: 1,
          height: "100vh",
          width: "100%",
          transition: "margin 0.3s",
          marginLeft: isSidebarOpen ? "0" : "0",
        }}
      ></div>
    </div>
  );
}
